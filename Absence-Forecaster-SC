<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<style>
 .absence-tracker-wrap{
  font-family:Arial,sans-serif;
  background:transparent;
  display:flex;
  justify-content:center;
  align-items:flex-start;   /* was center */
  padding:16px 0;
}

.absence-tracker{
  background:#fff;
  padding:1.5rem;
  border-radius:10px;
  box-shadow:0 0 10px rgba(0,0,0,.12);
  width:95%;
  max-width:520px;

  /* NEW: make the box tall enough so the expanded results fit */
  min-height: 520px;

  /* NEW: keep everything inside visible (avoid internal scrollbars) */
  overflow: visible;
}
  .absence-tracker h2{margin:0 0 .75rem 0}
  .absence-tracker label{display:block;margin:.5rem 0 .35rem 0}
  .absence-tracker input[type="number"]{padding:.75rem;width:100%;max-width:260px;font-size:1rem;margin:.25rem auto .75rem auto;display:block}
  .absence-tracker button{padding:.75rem 1.5rem;font-size:1rem;background:#4CAF50;color:#fff;border:none;border-radius:6px;cursor:pointer}
  .absence-tracker button:hover{background:#45a049}
  #at-currentDayDisplay,#at-result{margin-top:1rem;line-height:1.5;text-align:left}
  #at-currentDayDisplay{text-align:center;font-weight:bold}
  .at-row{margin-top:.5rem}
  .at-warning-icon{font-size:2rem;color:#d32f2f;margin-top:.75rem;text-align:center}
  .at-center{text-align:center}

#at-result { padding-bottom: 10px; }

</style>

<div class="absence-tracker-wrap">
  <div class="absence-tracker">
   <div class="at-center">
     <h2>ğŸ”®</h2>

    
      <label for="at-absences">Enter your current number of absences:</label>
      <input type="number" id="at-absences" min="0" step="1" inputmode="numeric"
             oninput="this.value=this.value.replace(/[^0-9]/g,'')">
      <button id="at-calcBtn" type="button">Calculate</button>
    </div>

    <div id="at-currentDayDisplay"></div>
    <div id="at-result"></div>
  </div>
</div>

<script>
  const schoolDays = [
    { day: 1, date: "09/04/25" }, { day: 2, date: "09/05/25" }, { day: 3, date: "09/08/25" },
    { day: 4, date: "09/09/25" }, { day: 5, date: "09/10/25" }, { day: 6, date: "09/11/25" },
    { day: 7, date: "09/12/25" }, { day: 8, date: "09/15/25" }, { day: 9, date: "09/16/25" },
    { day: 10, date: "09/17/25" }, { day: 11, date: "09/18/25" }, { day: 12, date: "09/19/25" },
    { day: 13, date: "09/22/25" }, { day: 14, date: "09/23/25" }, { day: 15, date: "09/24/25" },
    { day: 16, date: "09/25/25" }, { day: 17, date: "09/26/25" }, { day: 18, date: "09/29/25" },
    { day: 19, date: "09/30/25" }, { day: 20, date: "10/01/25" }, { day: 21, date: "10/02/25" },
    { day: 22, date: "10/03/25" }, { day: 23, date: "10/06/25" }, { day: 24, date: "10/07/25" },
    { day: 25, date: "10/08/25" }, { day: 26, date: "10/09/25" }, { day: 27, date: "10/10/25" },
    { day: 28, date: "10/14/25" }, { day: 29, date: "10/15/25" }, { day: 30, date: "10/16/25" },
    { day: 31, date: "10/17/25" }, { day: 32, date: "10/20/25" }, { day: 33, date: "10/21/25" },
    { day: 34, date: "10/22/25" }, { day: 35, date: "10/23/25" }, { day: 36, date: "10/24/25" },
    { day: 37, date: "10/27/25" }, { day: 38, date: "10/28/25" }, { day: 39, date: "10/29/25" },
    { day: 40, date: "10/30/25" }, { day: 41, date: "10/31/25" }, { day: 42, date: "11/03/25" },
    { day: 43, date: "11/04/25" }, { day: 44, date: "11/05/25" }, { day: 45, date: "11/10/25" },
    { day: 46, date: "11/11/25" }, { day: 47, date: "11/12/25" }, { day: 48, date: "11/13/25" },
    { day: 49, date: "11/14/25" }, { day: 50, date: "11/17/25" }, { day: 51, date: "11/18/25" },
    { day: 52, date: "11/19/25" }, { day: 53, date: "11/20/25" }, { day: 54, date: "11/21/25" },
    { day: 55, date: "11/24/25" }, { day: 56, date: "11/25/25" }, { day: 57, date: "11/26/25" },
    { day: 58, date: "12/01/25" }, { day: 59, date: "12/02/25" }, { day: 60, date: "12/03/25" },
    { day: 61, date: "12/04/25" }, { day: 62, date: "12/05/25" }, { day: 63, date: "12/08/25" },
    { day: 64, date: "12/09/25" }, { day: 65, date: "12/10/25" }, { day: 66, date: "12/11/25" },
    { day: 67, date: "12/12/25" }, { day: 68, date: "12/15/25" }, { day: 69, date: "12/16/25" },
    { day: 70, date: "12/17/25" }, { day: 71, date: "12/18/25" }, { day: 72, date: "12/19/25" },
    { day: 73, date: "12/22/25" }, { day: 74, date: "12/23/25" }, { day: 75, date: "01/05/26" },
    { day: 76, date: "01/06/26" }, { day: 77, date: "01/07/26" }, { day: 78, date: "01/08/26" },
    { day: 79, date: "01/09/26" }, { day: 80, date: "01/12/26" }, { day: 81, date: "01/13/26" },
    { day: 82, date: "01/14/26" }, { day: 83, date: "01/15/26" }, { day: 84, date: "01/16/26" },
    { day: 85, date: "01/20/26" }, { day: 86, date: "01/21/26" }, { day: 87, date: "01/22/26" },
    { day: 88, date: "01/23/26" }, { day: 89, date: "01/26/26" }, { day: 90, date: "01/27/26" },
    { day: 91, date: "01/28/26" }, { day: 92, date: "01/29/26" }, { day: 93, date: "01/30/26" },
    { day: 94, date: "02/02/26" }, { day: 95, date: "02/03/26" }, { day: 96, date: "02/04/26" },
    { day: 97, date: "02/05/26" }, { day: 98, date: "02/06/26" }, { day: 99, date: "02/09/26" },
    { day: 100, date: "02/10/26" }, { day: 101, date: "02/11/26" }, { day: 102, date: "02/12/26" },
    { day: 103, date: "02/17/26" }, { day: 104, date: "02/18/26" }, { day: 105, date: "02/19/26" },
    { day: 106, date: "02/20/26" }, { day: 107, date: "02/23/26" }, { day: 108, date: "02/24/26" },
    { day: 109, date: "02/25/26" }, { day: 110, date: "02/26/26" }, { day: 111, date: "02/27/26" },
    { day: 112, date: "03/02/26" }, { day: 113, date: "03/03/26" }, { day: 114, date: "03/04/26" },
    { day: 115, date: "03/05/26" }, { day: 116, date: "03/09/26" }, { day: 117, date: "03/10/26" },
    { day: 118, date: "03/11/26" }, { day: 119, date: "03/12/26" }, { day: 120, date: "03/13/26" },
    { day: 121, date: "03/16/26" }, { day: 122, date: "03/17/26" }, { day: 123, date: "03/18/26" },
    { day: 124, date: "03/19/26" }, { day: 125, date: "03/20/26" }, { day: 126, date: "03/23/26" },
    { day: 127, date: "03/24/26" }, { day: 128, date: "03/25/26" }, { day: 129, date: "03/26/26" },
    { day: 130, date: "03/27/26" }, { day: 131, date: "03/30/26" }, { day: 132, date: "03/31/26" },
    { day: 133, date: "04/01/26" }, { day: 134, date: "04/02/26" }, { day: 135, date: "04/13/26" },
    { day: 136, date: "04/14/26" }, { day: 137, date: "04/15/26" }, { day: 138, date: "04/16/26" },
    { day: 139, date: "04/17/26" }, { day: 140, date: "04/20/26" }, { day: 141, date: "04/21/26" },
    { day: 142, date: "04/22/26" }, { day: 143, date: "04/23/26" }, { day: 144, date: "04/24/26" },
    { day: 145, date: "04/27/26" }, { day: 146, date: "04/28/26" }, { day: 147, date: "04/29/26" },
    { day: 148, date: "04/30/26" }, { day: 149, date: "05/01/26" }, { day: 150, date: "05/04/26" },
    { day: 151, date: "05/05/26" }, { day: 152, date: "05/06/26" }, { day: 153, date: "05/07/26" },
    { day: 154, date: "05/08/26" }, { day: 155, date: "05/11/26" }, { day: 156, date: "05/12/26" },
    { day: 157, date: "05/13/26" }, { day: 158, date: "05/14/26" }, { day: 159, date: "05/15/26" },
    { day: 160, date: "05/18/26" }, { day: 161, date: "05/19/26" }, { day: 162, date: "05/20/26" },
    { day: 163, date: "05/21/26" }, { day: 164, date: "05/26/26" }, { day: 165, date: "05/27/26" },
    { day: 166, date: "05/28/26" }, { day: 167, date: "05/29/26" }, { day: 168, date: "06/01/26" },
    { day: 169, date: "06/02/26" }, { day: 170, date: "06/03/26" }, { day: 171, date: "06/04/26" },
    { day: 172, date: "06/05/26" }, { day: 173, date: "06/08/26" }, { day: 174, date: "06/09/26" },
    { day: 175, date: "06/10/26" }, { day: 176, date: "06/11/26" }, { day: 177, date: "06/12/26" },
    { day: 178, date: "06/15/26" }, { day: 179, date: "06/16/26" }, { day: 180, date: "06/17/26" }
  ];

  function parseDateMMDDYY(dateStr){
    const [mm, dd, yy] = dateStr.split('/').map(Number);
    return new Date(2000 + yy, mm - 1, dd, 12, 0, 0, 0); // noon local time (DST-safe)
  }

  function findCurrentSchoolDay(today){
    let current = null;
    const t = today.getTime();
    for (let i = 0; i < schoolDays.length; i++){
      const sd = parseDateMMDDYY(schoolDays[i].date).getTime();
      if (sd <= t) current = schoolDays[i];
      else break;
    }
    return current;
  }

  function findDateForSchoolDay(dayNumber){
    const found = schoolDays.find(x => x.day === dayNumber);
    return found ? found.date : null;
  }

  function buildProjectionHTML(absences, currentSchoolDay){
    // Projection appears immediately below percentage
    if (absences === 0){
      return `<div class="at-row"><strong>Projection:</strong> Keep it up â€” youâ€™re building a nice absence bank for later.</div>`;
    }
    if (absences >= 18){
      // We still show projection block (optional). If youâ€™d rather remove it for 18+, tell me.
      return ``;
    }

    const rate = absences / currentSchoolDay; // absences per school day
    if (rate <= 0) return ``;

    const daysUntil18 = Math.ceil((18 - absences) / rate);
    const predictedSchoolDay = currentSchoolDay + daysUntil18;

    if (predictedSchoolDay <= 180){
      const predictedDateStr = findDateForSchoolDay(predictedSchoolDay);
      if (predictedDateStr){
        return `<div class="at-row"><strong>Projection (if your current pace continues):</strong> You would hit <strong>18 absences</strong> around <strong>${predictedDateStr}</strong> (school day <strong>${predictedSchoolDay}</strong>).</div>`;
      }
      return ``;
    }

    return `<div class="at-row"><strong>Projection (if your current pace continues):</strong> At your current pace, you would not reach <strong>18 absences</strong> by the end of the school year.</div>`;
  }

  function calculateAbsences(){
    const absInput = document.getElementById('at-absences');
    const resultDiv = document.getElementById('at-result');
    const currentDayDisplay = document.getElementById('at-currentDayDisplay');

    resultDiv.innerHTML = '';
    currentDayDisplay.innerHTML = '';

    const absences = parseInt(absInput.value, 10);
    if (isNaN(absences) || absences < 0){
      resultDiv.innerHTML = `<div class="at-row">Please enter a valid number of absences.</div>`;
      return;
    }

    const now = new Date();
    const today = new Date(now.getFullYear(), now.getMonth(), now.getDate(), 12, 0, 0, 0);

    const current = findCurrentSchoolDay(today);
    if (!current){
      currentDayDisplay.textContent = 'School has not started yet.';
      return;
    }

    const currentSchoolDay = current.day;
    currentDayDisplay.textContent = `As of ${current.date}`;

    if (absences > currentSchoolDay){
      resultDiv.innerHTML = `<div class="at-row">That many absences is more days than school has been in session.</div>`;
      return;
    }

    const percentAbsent = (absences / currentSchoolDay) * 100;
    const absencesRemaining = Math.max(0, 18 - absences);

    // Build blocks in the exact order you requested:
    // 1) Percentage
    // 2) Projection
    // 3) Everything else
    const percentageHTML = `<div class="at-row">Percentage Absent: <strong>${percentAbsent.toFixed(2)}%</strong></div>`;
    const projectionHTML = buildProjectionHTML(absences, currentSchoolDay);

    if (absences >= 18){
      // Per your instruction: state it plainly; no consequences.
      resultDiv.innerHTML =
        percentageHTML +
        projectionHTML +
        `<div class="at-row"><strong>ğŸš¨ Youâ€™ve hit 18 absences.</strong></div>` +
        `<div class="at-warning-icon">âš ï¸</div>`;
      return;
    }

    // Messaging
    let statusMessage = '';
    if (percentAbsent <= 6){
      statusMessage =
        `<div class="at-row">âœ… Nice work! Youâ€™re under <strong>6%</strong> absent.</div>` +
        `<div class="at-row">Youâ€™re budgeting well and building a smart absence <strong>bank</strong> for later.</div>`;
      try{ confetti({ particleCount: 90, spread: 70, origin: { y: 0.15 } }); }catch(e){}
    } else if (percentAbsent < 10){
      statusMessage =
        `<div class="at-row">âš ï¸ Youâ€™re over the recommended <strong>6%</strong> goal.</div>` +
        `<div class="at-row">Your absence bank is shrinking â€” plan carefully.</div>`;
    } else {
      statusMessage =
        `<div class="at-row">ğŸš¨ Youâ€™re over <strong>10%</strong> absent.</div>` +
        `<div class="at-row">At this pace, youâ€™re burning through your absence bank.</div>` +
        `<div class="at-warning-icon">âš ï¸</div>`;
    }

    const bankLine =
      `<div class="at-row"><strong>Absence bank remaining:</strong> You can miss <strong>${absencesRemaining}</strong> more day${absencesRemaining === 1 ? '' : 's'} before reaching 18.</div>`;

    resultDiv.innerHTML =
      percentageHTML +
      projectionHTML +
      statusMessage +
      bankLine;
  }

  (function initAbsenceTracker(){
    const btn = document.getElementById('at-calcBtn');
    const input = document.getElementById('at-absences');
    if (btn) btn.addEventListener('click', calculateAbsences);
    if (input){
      input.addEventListener('keydown', function(e){
        if (e.key === 'Enter'){
          e.preventDefault();
          calculateAbsences();
        }
      });
    }
  })();
</script>
